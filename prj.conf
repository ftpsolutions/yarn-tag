# BLE broadcaster + dynamic ADV updates
CONFIG_BT=y
CONFIG_BT_BROADCASTER=y
CONFIG_BT_OBSERVER=n
CONFIG_BT_PERIPHERAL=y                 # needed for DFU window
CONFIG_BT_EXT_ADV=n
CONFIG_BT_DEVICE_NAME="YarnBeacon"

# Drivers / power / logging
CONFIG_SENSOR=y
CONFIG_GPIO=y
CONFIG_SPI=y
# CONFIG_PM=y            # Enable later if desired
# CONFIG_PM_DEVICE=y

CONFIG_LOG=y
CONFIG_LOG_DEFAULT_LEVEL=3

# Thread sizes
CONFIG_MAIN_STACK_SIZE=2304
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=1536

# --- OTA DFU via MCUboot + mcumgr BLE ---



# Keep BLE memory small
CONFIG_BT_MAX_CONN=1


# --- deps for mcumgr/img manager ---
CONFIG_FLASH=y
# Keep BLE minimal, connectable only for config windows
CONFIG_BT_SETTINGS=n
# Trim footprint
CONFIG_LOG=n
CONFIG_CONSOLE=n
CONFIG_PRINTK=n
CONFIG_SENSOR=n

# --- Tight RAM/Flash profile for nRF52810 ---
# Shrink core stacks
CONFIG_MAIN_STACK_SIZE=1536
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=1024
CONFIG_ISR_STACK_SIZE=1024
CONFIG_IDLE_STACK_SIZE=256

# Use minimal libc to reduce footprint
CONFIG_PICOLIBC=n
CONFIG_MINIMAL_LIBC=y
CONFIG_HEAP_MEM_POOL_SIZE=0

# Keep BLE minimal: 1 conn, no extended PHYs
CONFIG_BT_MAX_CONN=1
CONFIG_BT_CTLR_ADV_EXT=n
CONFIG_BT_CTLR_PHY_2M=n
CONFIG_BT_CTLR_PHY_CODED=n
CONFIG_BT_DATA_LEN_UPDATE=n

# Cut Bluetooth stacks/buffers
CONFIG_BT_RX_STACK_SIZE=1024
CONFIG_BT_HCI_TX_STACK_SIZE=512

CONFIG_BT_BUF_CMD_TX_COUNT=2
CONFIG_BT_BUF_EVT_RX_COUNT=2

# ACL buffer counts/sizes kept tiny; OK for brief config windows
CONFIG_BT_BUF_ACL_RX_COUNT=2
CONFIG_BT_BUF_ACL_TX_COUNT=1
CONFIG_BT_L2CAP_TX_BUF_COUNT=2
CONFIG_BT_CONN_TX_MAX=2

# Keep LL data length and MTU small
CONFIG_BT_CTLR_DATA_LENGTH_MAX=27

# Optional: slightly smaller generic RX size (headers + 27 bytes payload)
CONFIG_BT_BUF_ACL_TX_SIZE=27
CONFIG_BT_BUF_ACL_RX_SIZE=27

# Don't build features we don't use
CONFIG_BT_GATT_DYNAMIC_DB=n
